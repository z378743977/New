<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Â§öËØ≠Ë®ÄË°®ÂçïÂ°´ÂÜôÂ∫îÁî®</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            min-height: 100vh;
            position: relative;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            /* ÈùíËä±Áì∑Ê∏êÂèòËÉåÊôØÔºö‰ªéÁì∑ÁôΩÂà∞Ê∑°Èùí */
            background: linear-gradient(135deg, #F5F5F0 0%, #D4E4E7 50%, #B8D4D6 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(74, 144, 164, 0.05) 0%, transparent 70%);
            animation: rotate 30s linear infinite;
            pointer-events: none;
            z-index: 0;
        }
        
        @keyframes rotate {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
        
        #app {
            position: relative;
            z-index: 1;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            /* Áì∑ÁôΩËâ≤ */
            background: #FAFAF8;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(46, 79, 122, 0.15);
            padding: 30px;
            border: 1px solid rgba(62, 95, 138, 0.1);
        }
        
        .admin-container {
            max-width: 1400px;
        }
        
        h1 {
            text-align: center;
            /* Ê∑±ÈùíËä±Ëìù */
            color: #2E4F7A;
            font-size: 24px;
            margin-bottom: 30px;
            font-weight: bold;
        }
        
        .admin-title {
            /* ÁöáÂÆ∂ÈùíËä±Ëìù */
            color: #1E3A5F;
            font-size: 28px;
        }
        
        label {
            display: block;
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 8px;
            color: #2C3E50;
            transition: all 0.3s ease;
        }
        
        .form-group:hover label {
            color: #3E5F8A;
            transform: translateX(3px);
        }
        
        input[type="text"],
        input[type="date"],
        input[type="number"],
        select {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #D4E4E7;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
            background: white;
        }
        
        input[type="text"]:focus,
        input[type="date"]:focus,
        input[type="number"]:focus,
        select:focus {
            outline: none;
            /* ÈùíËä±ËìùËæπÊ°Ü */
            border-color: #3E5F8A;
            box-shadow: 0 0 0 3px rgba(62, 95, 138, 0.1);
            transform: translateY(-2px);
            background: #FEFEFE;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .language-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 30px;
        }
        
        .lang-btn {
            padding: 10px;
            border: none;
            border-radius: 8px;
            background: #E8F0F2;
            color: #2C3E50;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid rgba(62, 95, 138, 0.2);
        }
        
        .lang-btn:hover {
            background: #D4E4E7;
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 4px 12px rgba(62, 95, 138, 0.15);
        }
        
        .lang-btn.active {
            /* ÈùíËä±Ëìù */
            background: #3E5F8A;
            color: white;
            box-shadow: 0 4px 12px rgba(62, 95, 138, 0.4);
            animation: activePulse 2s ease-in-out infinite;
        }
        
        @keyframes activePulse {
            0%, 100% { 
                box-shadow: 0 4px 12px rgba(62, 95, 138, 0.4);
            }
            50% { 
                box-shadow: 0 6px 20px rgba(62, 95, 138, 0.6);
            }
        }
        
        .signature-container {
            border: 2px solid #B8D4D6;
            border-radius: 8px;
            overflow: hidden;
            margin-top: 10px;
            transition: all 0.3s ease;
        }
        
        .signature-container:hover {
            border-color: #4A90A4;
            box-shadow: 0 4px 16px rgba(74, 144, 164, 0.2);
            transform: scale(1.01);
        }
        
        canvas {
            display: block;
            width: 100%;
            background: white;
            cursor: crosshair;
            touch-action: none;
        }
        
        .clear-btn {
            margin-top: 10px;
            background: none;
            border: none;
            color: #C73E1D;
            font-size: 14px;
            cursor: pointer;
            text-decoration: underline;
        }
        
        .clear-btn:hover {
            color: #A32E15;
        }
        
        .generate-btn {
            width: 100%;
            padding: 15px;
            /* ÈùíËä±ËìùÊ∏êÂèò */
            background: linear-gradient(135deg, #3E5F8A 0%, #2E4F7A 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 30px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 4px 12px rgba(62, 95, 138, 0.2);
        }
        
        .generate-btn:hover {
            background: linear-gradient(135deg, #2E4F7A 0%, #1E3A5F 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(62, 95, 138, 0.3);
        }
        
        .note {
            text-align: center;
            font-size: 12px;
            color: #5A7A8F;
            margin-top: 20px;
        }
        
        /* Admin Mode Styles */
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .toggle-btn {
            padding: 10px 20px;
            background: #5A7A8F;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .toggle-btn:hover {
            background: #2E4F7A;
        }
        
        .admin-layout {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }
        
        .left-panel {
            background: #FAFAF8;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(62, 95, 138, 0.1);
            border: 1px solid rgba(62, 95, 138, 0.1);
        }
        
        .right-panel {
            background: #FAFAF8;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(62, 95, 138, 0.1);
            max-height: 800px;
            overflow-y: auto;
            border: 1px solid rgba(62, 95, 138, 0.1);
        }
        
        .section-title {
            font-size: 18px;
            font-weight: bold;
            color: #2E4F7A;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #B8D4D6;
            position: relative;
        }
        
        .section-title::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background: #4A90A4;
            transition: width 0.5s ease;
        }
        
        .section-title:hover::after {
            width: 100%;
        }
        
        .template-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .tab-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            background: #E8F0F2;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(62, 95, 138, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .tab-btn:hover {
            background: #D4E4E7;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(62, 95, 138, 0.15);
        }
        
        .tab-btn.active {
            background: #3E5F8A;
            color: white;
            box-shadow: 0 4px 12px rgba(62, 95, 138, 0.3);
        }
        
        .tab-btn.active::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shine 2s infinite;
        }
        
        @keyframes shine {
            0% {
                left: -100%;
            }
            100% {
                left: 100%;
            }
        }
        
        .language-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .lang-tab {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            background: #E8F0F2;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            border: 1px solid rgba(62, 95, 138, 0.2);
        }
        
        .lang-tab:hover {
            background: #D4E4E7;
            transform: scale(1.05);
        }
        
        .lang-tab.active {
            /* Ê∏ÖÊñ∞ÁöÑÈùíÁªøËâ≤ */
            background: #4A90A4;
            color: white;
            box-shadow: 0 4px 12px rgba(74, 144, 164, 0.4);
            transform: scale(1.05);
        }
        
        .field-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }
        
        .field-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            background: #E8F0F2;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(62, 95, 138, 0.2);
        }
        
        .field-btn:hover {
            background: #D4E4E7;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(62, 95, 138, 0.15);
        }
        
        .field-btn.active {
            background: #4A90A4;
            color: white;
            box-shadow: 0 2px 6px rgba(74, 144, 164, 0.2);
            animation: ripple 0.6s ease-out;
        }
        
        @keyframes ripple {
            0% {
                box-shadow: 0 0 0 0 rgba(74, 144, 164, 0.7);
            }
            100% {
                box-shadow: 0 0 0 20px rgba(74, 144, 164, 0);
            }
        }
        
        .preview-box {
            border: 2px solid #A8DADC;
            background: #F0F8F9;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        
        .preview-box:hover {
            box-shadow: 0 8px 24px rgba(74, 144, 164, 0.15);
        }
        
        .image-wrapper {
            position: relative;
            display: inline-block;
            max-width: 100%;
        }
        
        .preview-box img {
            max-width: 100%;
            cursor: crosshair;
            border: 2px dashed #A8DADC;
            display: block;
        }
        
        #markersContainer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .field-marker {
            position: absolute;
            width: 28px;
            height: 28px;
            background: rgba(74, 144, 164, 0.9);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            transform: translate(-50%, -150%);
            box-shadow: 0 2px 8px rgba(62, 95, 138, 0.3);
            border: 3px solid white;
            z-index: 10;
            animation: markerBounce 2s ease-in-out infinite;
        }
        
        @keyframes markerBounce {
            0%, 100% {
                transform: translate(-50%, -150%) scale(1);
            }
            50% {
                transform: translate(-50%, -160%) scale(1.1);
            }
        }
        
        .field-label {
            position: absolute;
            background: rgba(74, 144, 164, 0.95);
            color: white;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            transform: translate(-50%, -250%);
            white-space: nowrap;
            z-index: 10;
        }
        
        .field-preview-text {
            position: absolute;
            pointer-events: none;
            z-index: 8;
            white-space: nowrap;
            animation: textGlow 2s ease-in-out infinite;
        }
        
        @keyframes textGlow {
            0%, 100% {
                opacity: 0.7;
            }
            50% {
                opacity: 1;
            }
        }
        
        .field-list {
            margin-top: 20px;
        }
        
        .field-item {
            background: #F5F8F9;
            border: 1px solid #D4E4E7;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }
        
        .field-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(62, 95, 138, 0.1);
            border-color: #A8DADC;
        }
        
        .field-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .field-name {
            font-weight: 600;
            color: #2E4F7A;
        }
        
        .field-actions {
            display: flex;
            gap: 8px;
        }
        
        .edit-btn, .delete-btn {
            padding: 4px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .edit-btn::before,
        .delete-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .edit-btn:hover::before,
        .delete-btn:hover::before {
            width: 200px;
            height: 200px;
        }
        
        .edit-btn {
            background: #3E5F8A;
            color: white;
        }
        
        .edit-btn:hover {
            background: #2E4F7A;
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(62, 95, 138, 0.3);
        }
        
        .reposition-btn {
            padding: 4px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            background: #F7B500;
            color: white;
            transition: all 0.3s;
        }
        
        .reposition-btn.active {
            background: #C73E1D;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .delete-btn {
            background: #C73E1D;
            color: white;
        }
        
        .delete-btn:hover {
            background: #A32E15;
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(199, 62, 29, 0.3);
        }
        
        .field-params {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 12px;
            color: #5A7A8F;
        }
        
        .param-editor {
            background: white;
            border: 2px solid #3E5F8A;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
        }
        
        .param-row {
            display: grid;
            grid-template-columns: 100px 1fr;
            gap: 10px;
            margin-bottom: 12px;
            align-items: center;
        }
        
        .param-label {
            font-size: 13px;
            font-weight: 600;
            color: #2C3E50;
        }
        
        .save-param-btn {
            width: 100%;
            padding: 8px;
            background: #4A90A4;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .save-param-btn:hover {
            background: #3E7A8D;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .action-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .action-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.4);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .action-btn:hover::after {
            width: 300px;
            height: 300px;
        }
        
        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(62, 95, 138, 0.2);
        }
        
        .action-btn:active {
            transform: translateY(-1px);
        }
        
        .export-btn {
            background: #4A90A4;
            color: white;
        }
        
        .export-btn:hover {
            background: #3E7A8D;
        }
        
        .import-label {
            background: #3E5F8A;
            color: white;
        }
        
        .import-label:hover {
            background: #2E4F7A;
        }
        
        .upload-section {
            margin-bottom: 20px;
            padding: 15px;
            background: #F5F8F9;
            border-radius: 8px;
            border: 1px solid #D4E4E7;
            transition: all 0.3s ease;
        }
        
        .upload-section:hover {
            border-color: #A8DADC;
            background: #F0F8F9;
            box-shadow: 0 4px 12px rgba(74, 144, 164, 0.1);
            transform: scale(1.01);
        }
        
        /* Password Page */
        .password-container {
            max-width: 400px;
            text-align: center;
        }
        
        .password-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }
        
        .password-title {
            font-size: 24px;
            font-weight: bold;
            color: #2E4F7A;
            margin-bottom: 10px;
        }
        
        .password-subtitle {
            color: #5A7A8F;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .password-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #D4E4E7;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 20px;
            text-align: center;
            letter-spacing: 2px;
            background: white;
        }
        
        .password-input:focus {
            border-color: #3E5F8A;
            outline: none;
        }
        
        .password-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #3E5F8A 0%, #2E4F7A 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .password-btn:hover {
            background: linear-gradient(135deg, #2E4F7A 0%, #1E3A5F 100%);
        }
        
        .password-error {
            color: #C73E1D;
            font-size: 14px;
            margin-top: 10px;
            display: none;
        }
        
        .password-error.show {
            display: block;
        }
        
        .back-btn {
            margin-top: 20px;
            background: none;
            border: none;
            color: #5A7A8F;
            cursor: pointer;
            font-size: 14px;
            text-decoration: underline;
        }
        
        .back-btn:hover {
            color: #2E4F7A;
        }
        
        .hint-text {
            font-size: 12px;
            color: #5A7A8F;
            margin-top: 10px;
        }
        
        .mode-switch {
            margin-top: 15px;
            padding: 12px;
            background: #F0F8F9;
            border: 2px solid #A8DADC;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }
        
        .mode-switch:hover {
            border-color: #4A90A4;
            box-shadow: 0 4px 12px rgba(74, 144, 164, 0.15);
            transform: translateY(-2px);
        }
        
        .mode-switch input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .mode-switch label {
            margin: 0;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            color: #2E4F7A;
        }
        
        /* ÈÄöÁî®ÁöÑÁÇπÂáªÊ∞¥Ê≥¢Á∫πÊïàÊûú */
        button, .lang-btn, .tab-btn, .field-btn {
            position: relative;
            overflow: hidden;
        }
        
        button:active::after,
        .lang-btn:active::after,
        .tab-btn:active::after,
        .field-btn:active::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.6);
            transform: translate(-50%, -50%);
            animation: rippleEffect 0.6s ease-out;
        }
        
        @keyframes rippleEffect {
            to {
                width: 200px;
                height: 200px;
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        const translations = {
            zh: { title: 'ÂëòÂ∑•‰ø°ÊÅØË°®Âçï', selectLanguage: 'ÈÄâÊã©ËØ≠Ë®Ä', name: 'ÂßìÂêç', birthday: 'ÁîüÊó•', address: 'Âú∞ÂùÄ', addressSearch: 'ÊêúÁ¥¢Âú∞ÂùÄ', position: 'ËÅå‰Ωç', positionCustom: 'Ëá™Â°´', positionSelect: 'ÈÄâÊã©Â∑•Áßç', passport: 'Êä§ÁÖßÂè∑', phone: 'ÊâãÊú∫Âè∑', experience: 'Â∑•‰ΩúÁªèÂéÜ', experienceYears: 'Âπ¥', signature: 'Á≠æÂêç', clearSignature: 'Ê∏ÖÈô§Á≠æÂêç', generate: 'ÁîüÊàêË°®Âçï', adminMode: 'ÁÆ°ÁêÜÂëòÊ®°Âºè', userMode: 'Áî®Êà∑Ê®°Âºè', generateNote: 'ÁÇπÂáªÁîüÊàêÂêéÂ∞Ü‰∏ãËΩΩ2Âº†Â°´Â•ΩÁöÑË°®ÂçïÂõæÁâá(Ëá™Âä®Ê∑ªÂä†ÂΩìÂâçÊó•Êúü)', addressHint: 'üí° Âú®NaverÂú∞Âõæ‰∏≠ÊêúÁ¥¢Âú∞ÂùÄ,ÁÑ∂ÂêéÂ§çÂà∂Á≤òË¥¥Âà∞ËæìÂÖ•Ê°Ü' },
            ko: { title: 'ÏßÅÏõê Ï†ïÎ≥¥ ÏñëÏãù', selectLanguage: 'Ïñ∏Ïñ¥ ÏÑ†ÌÉù', name: 'ÏÑ±Î™Ö', birthday: 'ÏÉùÎÖÑÏõîÏùº', address: 'Ï£ºÏÜå', addressSearch: 'Ï£ºÏÜå Í≤ÄÏÉâ', position: 'ÏßÅÏ¢Ö', positionCustom: 'ÏßÅÏ†ë ÏûÖÎ†•', positionSelect: 'ÏÑ†ÌÉù', residentNum: 'Ï£ºÎØºÎì±Î°ùÎ≤àÌò∏', phone: 'Ï†ÑÌôîÎ≤àÌò∏', experience: 'Í≤ΩÎ†•', experienceYears: 'ÎÖÑ', signature: 'ÏÑúÎ™Ö', clearSignature: 'ÏÑúÎ™Ö ÏßÄÏö∞Í∏∞', generate: 'ÏñëÏãù ÏÉùÏÑ±', adminMode: 'Í¥ÄÎ¶¨Ïûê Î™®Îìú', userMode: 'ÏÇ¨Ïö©Ïûê Î™®Îìú', generateNote: 'ÏÉùÏÑ± Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÎ©¥ ÏûëÏÑ±Îêú ÏñëÏãù 2Ïû•Ïù¥ Îã§Ïö¥Î°úÎìúÎê©ÎãàÎã§(ÌòÑÏû¨ ÎÇ†Ïßú ÏûêÎèô Ï∂îÍ∞Ä)', addressHint: 'üí° Naver ÏßÄÎèÑÏóêÏÑú Ï£ºÏÜåÎ•º Í≤ÄÏÉâÌïú ÌõÑ ÏûÖÎ†•ÎûÄÏóê Î∂ôÏó¨ÎÑ£Í∏∞ ÌïòÏÑ∏Ïöî' },
            vi: { title: 'M·∫´u th√¥ng tin nh√¢n vi√™n', selectLanguage: 'Ch·ªçn ng√¥n ng·ªØ', name: 'H·ªç v√† t√™n', birthday: 'Ng√†y sinh', address: 'ƒê·ªãa ch·ªâ', addressSearch: 'T√¨m ƒë·ªãa ch·ªâ', position: 'V·ªã tr√≠', positionCustom: 'T·ª± nh·∫≠p', positionSelect: 'Ch·ªçn', passport: 'S·ªë h·ªô chi·∫øu', phone: 'S·ªë ƒëi·ªán tho·∫°i', experience: 'Kinh nghi·ªám', experienceYears: 'nƒÉm', signature: 'Ch·ªØ k√Ω', clearSignature: 'X√≥a ch·ªØ k√Ω', generate: 'T·∫°o m·∫´u', adminMode: 'Ch·∫ø ƒë·ªô qu·∫£n tr·ªã', userMode: 'Ch·∫ø ƒë·ªô ng∆∞·ªùi d√πng', generateNote: 'Nh·∫•p t·∫°o ƒë·ªÉ t·∫£i xu·ªëng 2 m·∫´u ƒë√£ ƒëi·ªÅn (t·ª± ƒë·ªông th√™m ng√†y hi·ªán t·∫°i)', addressHint: 'üí° T√¨m ki·∫øm ƒë·ªãa ch·ªâ tr√™n b·∫£n ƒë·ªì Naver, sau ƒë√≥ sao ch√©p v√† d√°n v√†o √¥ nh·∫≠p' },
            ru: { title: '–§–æ—Ä–º–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–µ', selectLanguage: '–í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫', name: '–§–ò–û', birthday: '–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è', address: '–ê–¥—Ä–µ—Å', addressSearch: '–ü–æ–∏—Å–∫ –∞–¥—Ä–µ—Å–∞', position: '–î–æ–ª–∂–Ω–æ—Å—Ç—å', positionCustom: '–í–≤–µ—Å—Ç–∏', positionSelect: '–í—ã–±—Ä–∞—Ç—å', passport: '–ù–æ–º–µ—Ä –ø–∞—Å–ø–æ—Ä—Ç–∞', phone: '–¢–µ–ª–µ—Ñ–æ–Ω', experience: '–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã', experienceYears: '–ª–µ—Ç', signature: '–ü–æ–¥–ø–∏—Å—å', clearSignature: '–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–¥–ø–∏—Å—å', generate: '–°–æ–∑–¥–∞—Ç—å —Ñ–æ—Ä–º—É', adminMode: '–†–µ–∂–∏–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞', userMode: '–†–µ–∂–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', generateNote: '–ü–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã 2 –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã (—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã)', addressHint: 'üí° –ù–∞–π–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –Ω–∞ –∫–∞—Ä—Ç–µ Naver, –∑–∞—Ç–µ–º —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞' }
        };

        const positionOptions = {
            zh: ['Êï¥ÁêÜ', 'ËÄÅÁÇÆ', 'ÊãÜÈô§', 'Èí¢Á≠ã', 'ÊµáÁ≠ë', 'Êû∂Â≠êÂ∑•', '‰ø°Âè∑Âëò', '‰∫åÁÇÆ', 'Èí¢ÁÇÆ', 'Á¢éÁü≥ÊäπÁÅ∞', 'ÂÆâÂÖ®'],
            ko: ['Ï†ïÎ¶¨', 'ÌòïÌãÄ', 'Ìï¥Ï≤¥', 'Ï≤†Í∑º', 'ÌÉÄÏÑ§', 'ÎπÑÍ≥Ñ', 'Ïã†Ìò∏Ïàò', 'ÏïåÌçº', 'Í∞±Ìçº', 'Ìï†ÏÑùÎØ∏Ïû•', 'ÏïàÏ†Ñ'],
            vi: ['Ï†ïÎ¶¨', 'ÌòïÌãÄ', 'Ìï¥Ï≤¥', 'Ï≤†Í∑º', 'ÌÉÄÏÑ§', 'ÎπÑÍ≥Ñ', 'Ïã†Ìò∏Ïàò', 'ÏïåÌçº', 'Í∞±Ìçº', 'Ìï†ÏÑùÎØ∏Ïû•', 'ÏïàÏ†Ñ'],
            ru: ['Ï†ïÎ¶¨', 'ÌòïÌãÄ', 'Ìï¥Ï≤¥', 'Ï≤†Í∑º', 'ÌÉÄÏÑ§', 'ÎπÑÍ≥Ñ', 'Ïã†Ìò∏Ïàò', 'ÏïåÌçº', 'Í∞±Ìçº', 'Ìï†ÏÑùÎØ∏Ïû•', 'ÏïàÏ†Ñ']
        };
        
        const positionMapping = {
            'Êï¥ÁêÜ': 'Ï†ïÎ¶¨',
            'ËÄÅÁÇÆ': 'ÌòïÌãÄ',
            'ÊãÜÈô§': 'Ìï¥Ï≤¥',
            'Èí¢Á≠ã': 'Ï≤†Í∑º',
            'ÊµáÁ≠ë': 'ÌÉÄÏÑ§',
            'Êû∂Â≠êÂ∑•': 'ÎπÑÍ≥Ñ',
            '‰ø°Âè∑Âëò': 'Ïã†Ìò∏Ïàò',
            '‰∫åÁÇÆ': 'ÏïåÌçº',
            'Èí¢ÁÇÆ': 'Í∞±Ìçº',
            'Á¢éÁü≥ÊäπÁÅ∞': 'Ìï†ÏÑùÎØ∏Ïû•',
            'ÂÆâÂÖ®': 'ÏïàÏ†Ñ'
        };
        
        function convertPositionToKorean(position) {
            return positionMapping[position] || position;
        }

        let state = {
            language: 'zh',
            formData: {},
            signature: null,
            isDrawing: false,
            isAdminMode: false,
            showPasswordPage: false,
            templates: { contract: { zh: null, ko: null }, safety: { zh: null, ko: null } },
            fieldPositions: { contract: { zh: {}, ko: {} }, safety: { zh: {}, ko: {} } },
            currentTemplate: 'contract',
            currentLang: 'zh',
            selectedField: null,
            editingField: null,
            multiInstanceMode: false,
            repositionTarget: null,
            positionMode: 'custom',
            showMapModal: false
        };

        function loadFromLocalStorage() {
            try {
                const saved = localStorage.getItem('formFillerConfig');
                if (saved) {
                    const config = JSON.parse(saved);
                    if (config.templates) state.templates = config.templates;
                    if (config.fieldPositions) state.fieldPositions = config.fieldPositions;
                    console.log('‚úÖ ÈÖçÁΩÆÂ∑≤‰ªéÊú¨Âú∞Âä†ËΩΩ');
                    return true;
                }
            } catch (e) {
                console.error('Âä†ËΩΩÈÖçÁΩÆÂ§±Ë¥•:', e);
            }
            return false;
        }
        
        async function loadDefaultConfig() {
            try {
                const response = await fetch('form-config.json');
                if (response.ok) {
                    const config = await response.json();
                    if (config.templates) state.templates = config.templates;
                    if (config.fieldPositions) state.fieldPositions = config.fieldPositions;
                    console.log('‚úÖ ÈªòËÆ§ÈÖçÁΩÆÂ∑≤Âä†ËΩΩ');
                    return true;
                }
            } catch (e) {
                console.log('‚ÑπÔ∏è Êú™ÊâæÂà∞ÈªòËÆ§ÈÖçÁΩÆÊñá‰ª∂');
            }
            return false;
        }

        function saveToLocalStorage() {
            try {
                const config = {
                    templates: state.templates,
                    fieldPositions: state.fieldPositions
                };
                localStorage.setItem('formFillerConfig', JSON.stringify(config));
                console.log('‚úÖ ÈÖçÁΩÆÂ∑≤Ëá™Âä®‰øùÂ≠ò');
            } catch (e) {
                console.error('‰øùÂ≠òÈÖçÁΩÆÂ§±Ë¥•:', e);
            }
        }

        async function initConfig() {
            const hasLocal = loadFromLocalStorage();
            if (!hasLocal) {
                await loadDefaultConfig();
            }
            render();
        }
        
        initConfig();

        let signatureCanvas = null;
        let ctx = null;

        function getFieldsList(lang) {
            if (lang === 'ko') {
                return ['name', 'birthday', 'address', 'residentNum', 'phone', 'position', 'experience', 'month', 'day', 'checkmark', 'signature'];
            }
            return ['name', 'birthday', 'address', 'position', 'passport', 'phone', 'experience', 'month', 'day', 'checkmark', 'signature'];
        }
        
        function getCurrentMonth() {
            const now = new Date();
            return String(now.getMonth() + 1);
        }
        
        function getCurrentDay() {
            const now = new Date();
            return String(now.getDate());
        }

        function startDrawing(e) {
            const rect = signatureCanvas.getBoundingClientRect();
            const x = (e.clientX || e.touches?.[0]?.clientX) - rect.left;
            const y = (e.clientY || e.touches?.[0]?.clientY) - rect.top;
            ctx.beginPath();
            ctx.moveTo(x, y);
            state.isDrawing = true;
        }

        function draw(e) {
            if (!state.isDrawing) return;
            e.preventDefault();
            const rect = signatureCanvas.getBoundingClientRect();
            const x = (e.clientX || e.touches?.[0]?.clientX) - rect.left;
            const y = (e.clientY || e.touches?.[0]?.clientY) - rect.top;
            ctx.lineTo(x, y);
            ctx.stroke();
        }

        function stopDrawing() {
            if (state.isDrawing) {
                state.isDrawing = false;
                state.signature = signatureCanvas.toDataURL();
            }
        }

        function clearSignature() {
            ctx.clearRect(0, 0, signatureCanvas.width, signatureCanvas.height);
            state.signature = null;
        }

        async function generateForms() {
            if (!state.signature) {
                const messages = { zh: 'ËØ∑ÂÖàÁ≠æÂêç', ko: 'ÏÑúÎ™ÖÏùÑ Ìï¥Ï£ºÏÑ∏Ïöî', vi: 'Vui l√≤ng k√Ω t√™n', ru: '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–ø–∏—à–∏—Ç–µ' };
                alert(messages[state.language]);
                return;
            }

            const langKey = state.language === 'ko' ? 'ko' : 'zh';
            for (const templateType of ['contract', 'safety']) {
                await generateForm(templateType, langKey);
            }
        }

        async function generateForm(templateType, langKey) {
            const template = state.templates[templateType][langKey];
            const positions = state.fieldPositions[templateType][langKey];
            
            if (!template || !positions || Object.keys(positions).length === 0) {
                return;
            }

            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            
            await new Promise((resolve) => {
                img.onload = () => {
                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.drawImage(img, 0, 0);
                    ctx.textBaseline = 'top';

                    Object.keys(positions).forEach(fieldKey => {
                        const pos = positions[fieldKey];
                        const baseField = pos.baseField || fieldKey;
                        
                        let textValue = '';
                        
                        if (baseField === 'month') {
                            textValue = getCurrentMonth();
                        } else if (baseField === 'day') {
                            textValue = getCurrentDay();
                        } else if (baseField === 'checkmark') {
                            textValue = '‚úì';
                        } else if (pos && state.formData[baseField]) {
                            textValue = state.formData[baseField];
                            
                            if (baseField === 'experience' && textValue) {
                                textValue = getFormattedExperience(textValue, langKey);
                            }
                            else if (baseField === 'position' && textValue) {
                                textValue = convertPositionToKorean(textValue);
                            }
                        }
                        
                        if (textValue && pos) {
                            ctx.font = `${pos.fontSize || 44}px Arial`;
                            ctx.fillStyle = pos.color || '#000000';
                            ctx.fillText(textValue, pos.x, pos.y);
                        }
                    });

                    Object.keys(positions).forEach(fieldKey => {
                        const pos = positions[fieldKey];
                        const baseField = pos.baseField || fieldKey;
                        
                        if (baseField === 'signature' && pos && state.signature) {
                            const sigImg = new Image();
                            sigImg.onload = () => {
                                const width = pos.width || 150;
                                const height = pos.height || 50;
                                ctx.drawImage(sigImg, pos.x, pos.y, width, height);
                            };
                            sigImg.src = state.signature;
                        }
                    });

                    setTimeout(() => {
                        canvas.toBlob(blob => {
                            const url = URL.createObjectURL(blob);
                            const a = document.createElement('a');
                            a.href = url;
                            a.download = `${templateType === 'contract' ? 'Âä≥Âä®ÂêàÂêå' : 'ÂÆâÂÖ®ÂçèËÆÆ'}_${langKey}.png`;
                            a.click();
                            URL.revokeObjectURL(url);
                            resolve();
                        });
                    }, 100);
                };
                img.src = template;
            });
        }

        function handleTemplateUpload(e, templateType, langKey) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    state.templates[templateType][langKey] = event.target.result;
                    saveToLocalStorage();
                    render();
                    setTimeout(renderFieldMarkers, 100);
                };
                reader.readAsDataURL(file);
            }
        }

        function handleImageClick(e) {
            const img = e.target;
            const rect = img.getBoundingClientRect();
            const scaleX = img.naturalWidth / rect.width;
            const scaleY = img.naturalHeight / rect.height;
            const x = (e.clientX - rect.left) * scaleX;
            const y = (e.clientY - rect.top) * scaleY;
            
            const positions = state.fieldPositions[state.currentTemplate][state.currentLang];
            
            let fieldKey;
            
            if (state.repositionTarget) {
                fieldKey = state.repositionTarget;
                state.repositionTarget = null;
            }
            else if (state.selectedField) {
                fieldKey = state.selectedField;
                
                if (state.multiInstanceMode && positions[fieldKey]) {
                    let instanceNum = 2;
                    while (positions[`${state.selectedField}_${instanceNum}`]) {
                        instanceNum++;
                    }
                    fieldKey = `${state.selectedField}_${instanceNum}`;
                }
            } else {
                return;
            }
            
            positions[fieldKey] = {
                x: Math.round(x),
                y: Math.round(y),
                fontSize: positions[fieldKey]?.fontSize || 44,
                color: positions[fieldKey]?.color || '#000000',
                baseField: positions[fieldKey]?.baseField || state.selectedField || fieldKey.replace(/_\d+$/, ''),
                width: (positions[fieldKey]?.baseField === 'signature' || state.selectedField === 'signature') ? (positions[fieldKey]?.width || 150) : undefined,
                height: (positions[fieldKey]?.baseField === 'signature' || state.selectedField === 'signature') ? (positions[fieldKey]?.height || 50) : undefined
            };
            
            saveToLocalStorage();
            render();
            setTimeout(renderFieldMarkers, 50);
        }
        
        function repositionField(fieldKey) {
            state.repositionTarget = fieldKey;
            state.selectedField = null;
            render();
        }
        
        function formatPhoneNumber(value) {
            const numbers = value.replace(/\D/g, '');
            if (numbers.length <= 3) {
                return numbers;
            } else if (numbers.length <= 7) {
                return numbers.slice(0, 3) + '-' + numbers.slice(3);
            } else {
                return numbers.slice(0, 3) + '-' + numbers.slice(3, 7) + '-' + numbers.slice(7, 11);
            }
        }
        
        function formatResidentNum(value) {
            const numbers = value.replace(/\D/g, '');
            if (numbers.length <= 6) {
                return numbers;
            } else {
                return numbers.slice(0, 6) + '-' + numbers.slice(6, 13);
            }
        }
        
        function formatExperience(value) {
            const numbers = value.replace(/\D/g, '');
            return numbers;
        }
        
        function getFormattedExperience(value, lang) {
            return value ? value + 'ÎÖÑ' : '';
        }
        
        function openAddressSearch() {
            const hints = {
                zh: {
                    title: 'üó∫Ô∏è Naver Âú∞Âõæ - Âú∞ÂùÄÊêúÁ¥¢',
                    close: '‚úï ÂÖ≥Èó≠',
                    instruction: 'üîç ‰ΩøÁî®ËØ¥ÊòéÔºö',
                    step1: '1. Âú®‰∏ãÊñπNaverÂú∞Âõæ‰∏≠ÊêúÁ¥¢‰Ω†ÁöÑÂú∞ÂùÄ',
                    step2: '2. ÊâæÂà∞Âú∞ÂùÄÂêé,ÁÇπÂáªÂπ∂Â§çÂà∂ÂÆåÊï¥Âú∞ÂùÄ',
                    step3: '3. ËøîÂõûË°®Âçï,Á≤òË¥¥Âà∞Âú∞ÂùÄËæìÂÖ•Ê°Ü‰∏≠',
                    step4: '4. ÁÇπÂáª"‚úï ÂÖ≥Èó≠"ÊåâÈíÆËøîÂõûË°®Âçï'
                },
                ko: {
                    title: 'üó∫Ô∏è Naver ÏßÄÎèÑ - Ï£ºÏÜå Í≤ÄÏÉâ',
                    close: '‚úï Îã´Í∏∞',
                    instruction: 'üîç ÏÇ¨Ïö© Î∞©Î≤ïÔºö',
                    step1: '1. ÏïÑÎûò Naver ÏßÄÎèÑÏóêÏÑú Ï£ºÏÜåÎ•º Í≤ÄÏÉâÌïòÏÑ∏Ïöî',
                    step2: '2. Ï£ºÏÜåÎ•º Ï∞æÏùÄ ÌõÑ ÌÅ¥Î¶≠ÌïòÏó¨ Ï†ÑÏ≤¥ Ï£ºÏÜåÎ•º Î≥µÏÇ¨ÌïòÏÑ∏Ïöî',
                    step3: '3. ÏñëÏãùÏúºÎ°ú ÎèåÏïÑÍ∞ÄÏÑú Ï£ºÏÜå ÏûÖÎ†•ÎûÄÏóê Î∂ôÏó¨ÎÑ£Í∏∞ ÌïòÏÑ∏Ïöî',
                    step4: '4. "‚úï Îã´Í∏∞" Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ ÏñëÏãùÏúºÎ°ú ÎèåÏïÑÍ∞ÄÏÑ∏Ïöî'
                },
                vi: {
                    title: 'üó∫Ô∏è B·∫£n ƒë·ªì Naver - T√¨m ƒë·ªãa ch·ªâ',
                    close: '‚úï ƒê√≥ng',
                    instruction: 'üîç H∆∞·ªõng d·∫´nÔºö',
                    step1: '1. T√¨m ki·∫øm ƒë·ªãa ch·ªâ c·ªßa b·∫°n trong b·∫£n ƒë·ªì Naver b√™n d∆∞·ªõi',
                    step2: '2. Sau khi t√¨m th·∫•y, nh·∫•p v√† sao ch√©p ƒë·ªãa ch·ªâ ƒë·∫ßy ƒë·ªß',
                    step3: '3. Quay l·∫°i bi·ªÉu m·∫´u v√† d√°n v√†o √¥ ƒë·ªãa ch·ªâ',
                    step4: '4. Nh·∫•p n√∫t "‚úï ƒê√≥ng" ƒë·ªÉ quay l·∫°i bi·ªÉu m·∫´u'
                },
                ru: {
                    title: 'üó∫Ô∏è –ö–∞—Ä—Ç–∞ Naver - –ü–æ–∏—Å–∫ –∞–¥—Ä–µ—Å–∞',
                    close: '‚úï –ó–∞–∫—Ä—ã—Ç—å',
                    instruction: 'üîç –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—èÔºö',
                    step1: '1. –ù–∞–π–¥–∏—Ç–µ —Å–≤–æ–π –∞–¥—Ä–µ—Å –Ω–∞ –∫–∞—Ä—Ç–µ Naver –Ω–∏–∂–µ',
                    step2: '2. –ü–æ—Å–ª–µ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –Ω–∞–∂–º–∏—Ç–µ –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–æ–ª–Ω—ã–π –∞–¥—Ä–µ—Å',
                    step3: '3. –í–µ—Ä–Ω–∏—Ç–µ—Å—å –∫ —Ñ–æ—Ä–º–µ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ –ø–æ–ª–µ –∞–¥—Ä–µ—Å–∞',
                    step4: '4. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "‚úï –ó–∞–∫—Ä—ã—Ç—å" —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ñ–æ—Ä–º–µ'
                }
            };
            
            const t = hints[state.language] || hints.zh;
            
            const overlay = document.createElement('div');
            overlay.id = 'mapModalOverlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.85);
                z-index: 999999;
                display: flex;
                justify-content: center;
                align-items: center;
                padding: 20px;
            `;
            
            const content = document.createElement('div');
            content.style.cssText = `
                background: white;
                border-radius: 12px;
                width: 95%;
                max-width: 1100px;
                height: 90vh;
                max-height: 850px;
                display: flex;
                flex-direction: column;
                overflow: hidden;
                box-shadow: 0 25px 80px rgba(0,0,0,0.6);
            `;
            
            content.innerHTML = `
                <div style="padding: 20px 25px; border-bottom: 2px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center; background: white; flex-shrink: 0;">
                    <h2 style="font-size: 20px; font-weight: bold; color: #1f2937; margin: 0;">${t.title}</h2>
                    <button id="closeMapBtn" style="background: #C73E1D; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 16px;">${t.close}</button>
                </div>
                <div style="flex: 1; padding: 20px; overflow: hidden; display: flex; flex-direction: column; gap: 15px; background: #f9fafb;">
                    <div style="background: #F0F8F9; border: 2px solid #A8DADC; padding: 15px; border-radius: 8px; font-size: 14px; color: #2E4F7A; flex-shrink: 0;">
                        <strong>${t.instruction}</strong><br>
                        ${t.step1}<br>
                        ${t.step2}<br>
                        ${t.step3}<br>
                        ${t.step4}
                    </div>
                    <iframe src="https://map.naver.com/" style="width: 100%; flex: 1; border: 2px solid #e5e7eb; border-radius: 8px; background: white;"></iframe>
                </div>
            `;
            
            overlay.appendChild(content);
            
            overlay.addEventListener('click', function(e) {
                if (e.target === overlay) {
                    closeMapModalDirect();
                }
            });
            
            content.querySelector('#closeMapBtn').addEventListener('click', closeMapModalDirect);
            
            document.body.style.overflow = 'hidden';
            
            document.body.appendChild(overlay);
        }
        
        function closeMapModalDirect() {
            const overlay = document.getElementById('mapModalOverlay');
            if (overlay) {
                overlay.remove();
            }
            document.body.style.overflow = '';
        }
        
        function closeMapModal() {
            closeMapModalDirect();
        }

        function editField(fieldName) {
            state.editingField = fieldName;
            render();
        }

        function deleteField(fieldName) {
            if (confirm(`Á°ÆÂÆöÂà†Èô§ ${getFieldDisplayName(fieldName)} ÁöÑÈÖçÁΩÆÂêó?`)) {
                delete state.fieldPositions[state.currentTemplate][state.currentLang][fieldName];
                saveToLocalStorage();
                render();
                setTimeout(renderFieldMarkers, 50);
            }
        }

        function saveFieldParams() {
            const fontSize = document.getElementById('editFontSize').value;
            const color = document.getElementById('editColor').value;
            const width = document.getElementById('editWidth')?.value;
            const height = document.getElementById('editHeight')?.value;
            
            const pos = state.fieldPositions[state.currentTemplate][state.currentLang][state.editingField];
            pos.fontSize = parseInt(fontSize);
            pos.color = color;
            if (width) pos.width = parseInt(width);
            if (height) pos.height = parseInt(height);
            
            state.editingField = null;
            saveToLocalStorage();
            render();
            setTimeout(renderFieldMarkers, 50);
        }
        
        function getExampleText(fieldKey, lang) {
            const baseField = fieldKey.replace(/_\d+$/, '');
            
            const examples = {
                name: { zh: 'Âº†‰∏â', ko: 'ÍπÄÏ≤†Ïàò', vi: 'Nguy·ªÖn VƒÉn A', ru: '–ò–≤–∞–Ω–æ–≤' },
                birthday: { zh: '1990-01-01', ko: '1990-01-01', vi: '1990-01-01', ru: '1990-01-01' },
                address: { zh: 'Âåó‰∫¨Â∏ÇÊúùÈò≥Âå∫', ko: 'ÏÑúÏö∏Ïãú Í∞ïÎÇ®Íµ¨', vi: 'H√† N·ªôi', ru: '–ú–æ—Å–∫–≤–∞' },
                position: { zh: 'Êï¥ÁêÜ', ko: 'Ï†ïÎ¶¨', vi: 'Ï†ïÎ¶¨', ru: 'Ï†ïÎ¶¨' },
                passport: { zh: 'E12345678', ko: 'M12345678', vi: 'B1234567', ru: 'AB1234567' },
                phone: { zh: '138-0013-8000', ko: '010-1234-5678', vi: '091-2345-678', ru: '+7 900 123-45-67' },
                residentNum: { zh: '110101-1990011234', ko: '900101-1234567', vi: '001090-0001234', ru: '123456-7890123' },
                experience: { zh: '3ÎÖÑ', ko: '3ÎÖÑ', vi: '3ÎÖÑ', ru: '3ÎÖÑ' },
                month: { zh: getCurrentMonth(), ko: getCurrentMonth(), vi: getCurrentMonth(), ru: getCurrentMonth() },
                day: { zh: getCurrentDay(), ko: getCurrentDay(), vi: getCurrentDay(), ru: getCurrentDay() },
                checkmark: { zh: '‚úì', ko: '‚úì', vi: '‚úì', ru: '‚úì' },
                signature: { zh: 'Âº†‰∏â', ko: 'ÍπÄÏ≤†Ïàò', vi: 'Nguy·ªÖn VƒÉn A', ru: '–ò–≤–∞–Ω–æ–≤' }
            };
            
            const langKey = lang === 'ko' ? 'ko' : (lang === 'vi' ? 'vi' : (lang === 'ru' ? 'ru' : 'zh'));
            return examples[baseField]?.[langKey] || examples[baseField]?.zh || 'Á§∫‰æã';
        }
        
        function getFieldDisplayName(fieldKey) {
            const match = fieldKey.match(/^(.+)_(\d+)$/);
            if (match) {
                return `${match[1]} (${match[2]})`;
            }
            return fieldKey;
        }

        function renderFieldMarkers() {
            const img = document.getElementById('templateImage');
            const container = document.getElementById('markersContainer');
            
            if (!img || !container) return;
            
            const positions = state.fieldPositions[state.currentTemplate][state.currentLang];
            if (!positions) return;
            
            container.innerHTML = '';
            
            const displayWidth = img.clientWidth;
            const displayHeight = img.clientHeight;
            const naturalWidth = img.naturalWidth;
            const naturalHeight = img.naturalHeight;
            
            const scaleX = displayWidth / naturalWidth;
            const scaleY = displayHeight / naturalHeight;
            
            let markerIndex = 1;
            Object.keys(positions).forEach(fieldKey => {
                const pos = positions[fieldKey];
                if (pos && pos.x !== undefined && pos.y !== undefined) {
                    const displayX = pos.x * scaleX;
                    const displayY = pos.y * scaleY;
                    
                    const baseField = pos.baseField || fieldKey;
                    
                    const marker = document.createElement('div');
                    marker.className = 'field-marker';
                    marker.textContent = markerIndex;
                    marker.style.left = displayX + 'px';
                    marker.style.top = displayY + 'px';
                    
                    const label = document.createElement('div');
                    label.className = 'field-label';
                    label.textContent = getFieldDisplayName(fieldKey);
                    label.style.left = displayX + 'px';
                    label.style.top = displayY + 'px';
                    
                    if (baseField !== 'signature') {
                        const previewText = document.createElement('div');
                        previewText.className = 'field-preview-text';
                        previewText.textContent = getExampleText(fieldKey, state.currentLang);
                        previewText.style.left = displayX + 'px';
                        previewText.style.top = displayY + 'px';
                        previewText.style.fontSize = ((pos.fontSize || 44) * scaleX) + 'px';
                        previewText.style.color = pos.color || '#000000';
                        previewText.style.fontFamily = 'Arial';
                        
                        container.appendChild(previewText);
                    } else {
                        const sigBox = document.createElement('div');
                        sigBox.style.position = 'absolute';
                        sigBox.style.left = displayX + 'px';
                        sigBox.style.top = displayY + 'px';
                        sigBox.style.width = ((pos.width || 150) * scaleX) + 'px';
                        sigBox.style.height = ((pos.height || 50) * scaleY) + 'px';
                        sigBox.style.border = '2px dashed rgba(74, 144, 164, 0.6)';
                        sigBox.style.backgroundColor = 'rgba(74, 144, 164, 0.1)';
                        sigBox.style.zIndex = '8';
                        sigBox.style.pointerEvents = 'none';
                        container.appendChild(sigBox);
                    }
                    
                    container.appendChild(marker);
                    container.appendChild(label);
                    markerIndex++;
                }
            });
        }

        function downloadConfig() {
            const config = { templates: state.templates, fieldPositions: state.fieldPositions };
            const blob = new Blob([JSON.stringify(config, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'form-config.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        function loadConfig(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const config = JSON.parse(event.target.result);
                        state.templates = config.templates || { contract: { zh: null, ko: null }, safety: { zh: null, ko: null } };
                        state.fieldPositions = config.fieldPositions || { contract: { zh: {}, ko: {} }, safety: { zh: {}, ko: {} } };
                        saveToLocalStorage();
                        render();
                        setTimeout(renderFieldMarkers, 100);
                        alert('‚úÖ ÈÖçÁΩÆÂØºÂÖ•ÊàêÂäü!');
                    } catch {
                        alert('‚ùå ÈÖçÁΩÆÊñá‰ª∂Ê†ºÂºèÈîôËØØ');
                    }
                };
                reader.readAsText(file);
            }
        }
        
        function clearAllData() {
            if (confirm('‚ö†Ô∏è Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâÈÖçÁΩÆÂêó?Ê≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§ç!')) {
                localStorage.removeItem('formFillerConfig');
                state.templates = { contract: { zh: null, ko: null }, safety: { zh: null, ko: null } };
                state.fieldPositions = { contract: { zh: {}, ko: {} }, safety: { zh: {}, ko: {} } };
                render();
                alert('‚úÖ ÊâÄÊúâÈÖçÁΩÆÂ∑≤Ê∏ÖÁ©∫');
            }
        }

        function toggleMode() {
            if (!state.isAdminMode) {
                state.showPasswordPage = true;
                render();
            } else {
                state.isAdminMode = false;
                render();
            }
        }
        
        function checkPassword() {
            const passwordInput = document.getElementById('passwordInput');
            const errorMsg = document.getElementById('errorMsg');
            const password = passwordInput.value;
            
            if (password === 'admin123') {
                state.showPasswordPage = false;
                state.isAdminMode = true;
                render();
            } else {
                errorMsg.classList.add('show');
                passwordInput.value = '';
                passwordInput.focus();
                setTimeout(() => errorMsg.classList.remove('show'), 3000);
            }
        }
        
        function cancelPassword() {
            state.showPasswordPage = false;
            render();
        }
        
        function handlePasswordKeyPress(e) {
            if (e.key === 'Enter') checkPassword();
        }

        function renderPasswordPage() {
            return `
                <div class="container password-container">
                    <div class="password-icon">üîê</div>
                    <h2 class="password-title">ÁÆ°ÁêÜÂëòÈ™åËØÅ</h2>
                    <p class="password-subtitle">ËØ∑ËæìÂÖ•ÁÆ°ÁêÜÂëòÂØÜÁ†Å‰ª•ÁªßÁª≠</p>
                    <input type="password" id="passwordInput" class="password-input" placeholder="ËØ∑ËæìÂÖ•ÂØÜÁ†Å" onkeypress="handlePasswordKeyPress(event)" autofocus>
                    <button onclick="checkPassword()" class="password-btn">Á°ÆËÆ§ÁôªÂΩï</button>
                    <p id="errorMsg" class="password-error">‚ùå ÂØÜÁ†ÅÈîôËØØ,ËØ∑ÈáçËØï</p>
                    <button onclick="cancelPassword()" class="back-btn">ËøîÂõû</button>
                </div>
            `;
        }

        function renderAdminMode() {
            const t = translations[state.language];
            const positions = state.fieldPositions[state.currentTemplate][state.currentLang];
            const fieldsList = getFieldsList(state.currentLang);
            
            return `
                <div class="container admin-container">
                    <div class="admin-header">
                        <h1 class="admin-title">ÁÆ°ÁêÜÂëòÈÖçÁΩÆÊ®°Âºè</h1>
                        <button onclick="toggleMode()" class="toggle-btn">${t.userMode}</button>
                    </div>

                    <div class="admin-layout">
                        <div class="left-panel">
                            <h3 class="section-title">üìã Ê®°ÊùøÈÖçÁΩÆ</h3>
                            
                            <div class="template-tabs">
                                <button onclick="state.currentTemplate='contract'; render(); setTimeout(renderFieldMarkers, 100);" class="tab-btn ${state.currentTemplate === 'contract' ? 'active' : ''}">Âä≥Âä®ÂêàÂêå</button>
                                <button onclick="state.currentTemplate='safety'; render(); setTimeout(renderFieldMarkers, 100);" class="tab-btn ${state.currentTemplate === 'safety' ? 'active' : ''}">ÂÆâÂÖ®ÂçèËÆÆ</button>
                            </div>

                            <div class="language-tabs">
                                <button onclick="state.currentLang='zh'; render(); setTimeout(renderFieldMarkers, 100);" class="lang-tab ${state.currentLang === 'zh' ? 'active' : ''}">‰∏≠Êñá/Ë∂äÂçóËØ≠/‰øÑËØ≠</button>
                                <button onclick="state.currentLang='ko'; render(); setTimeout(renderFieldMarkers, 100);" class="lang-tab ${state.currentLang === 'ko' ? 'active' : ''}">ÌïúÍµ≠Ïñ¥</button>
                            </div>

                            <div class="upload-section">
                                <label>üì§ ‰∏ä‰º† ${state.currentTemplate === 'contract' ? 'Âä≥Âä®ÂêàÂêå' : 'ÂÆâÂÖ®ÂçèËÆÆ'} Ê®°Êùø (${state.currentLang === 'zh' ? '‰∏≠Êñá/Ë∂äÂçóËØ≠/‰øÑËØ≠' : 'ÌïúÍµ≠Ïñ¥'})</label>
                                <input type="file" accept="image/*" onchange="handleTemplateUpload(event, '${state.currentTemplate}', '${state.currentLang}')" style="margin-top: 10px;">
                            </div>

                            <div class="form-group">
                                <label>üéØ ÈÄâÊã©Â≠óÊÆµ (ÁÇπÂáªÂêéÂÜçÁÇπÂáªÂõæÁâáÂÆö‰Ωç)</label>
                                <div class="field-buttons">
                                    ${fieldsList.map(field => 
                                        `<button onclick="state.selectedField='${field}'; render();" class="field-btn ${state.selectedField === field ? 'active' : ''}">${field === 'checkmark' ? '‚úì' : field}</button>`
                                    ).join('')}
                                </div>
                                
                                <div class="mode-switch">
                                    <input type="checkbox" id="multiInstanceMode" ${state.multiInstanceMode ? 'checked' : ''} onchange="state.multiInstanceMode = this.checked; render();">
                                    <label for="multiInstanceMode">üîÑ Â§öÂÆû‰æãÊ®°Âºè(Âêå‰∏ÄÂ≠óÊÆµÂàõÂª∫Â§ö‰∏™‰ΩçÁΩÆ)</label>
                                </div>
                                
                                <p class="hint-text">
                                    ${state.multiInstanceMode ? 
                                        '‚úÖ Â§öÂÆû‰æãÊ®°ÂºèÂ∑≤ÂºÄÂêØ:ÁÇπÂáªÂõæÁâáÂ∞ÜÂàõÂª∫Êñ∞ÁöÑÂ≠óÊÆµÂÆû‰æã(name ‚Üí name_2 ‚Üí name_3...)' : 
                                        'üîç ÊôÆÈÄöÊ®°Âºè:ÁÇπÂáªÂõæÁâáÂ∞ÜÊõ¥Êñ∞Â∑≤ÈÄâÂ≠óÊÆµÁöÑ‰ΩçÁΩÆ'}
                                </p>
                                <p class="hint-text" style="color: #4A90A4;">üí° Êúà‰ªΩ/Êó•Êúü/ÂØπÂè∑Â≠óÊÆµ‰ºöËá™Âä®Â°´ÂÖÖÂΩìÂâçÂÄº,Êó†ÈúÄÁî®Êà∑ËæìÂÖ•</p>
                            </div>

                            ${state.templates[state.currentTemplate][state.currentLang] ? `
                                <div class="preview-box">
                                    <p style="margin-bottom: 10px; font-weight: 600; color: #2E4F7A;">
                                        ${state.repositionTarget ? 
                                            `üéØ ÁÇπÂáªÂõæÁâáÈáçÊñ∞ÂÆö‰Ωç: ${getFieldDisplayName(state.repositionTarget)}` : 
                                            (state.selectedField ? `‚úÖ Â∑≤ÈÄâÊã©: ${state.selectedField}` : '‚ö†Ô∏è ËØ∑ÂÖàÈÄâÊã©‰∏Ä‰∏™Â≠óÊÆµ')}
                                    </p>
                                    <div class="image-wrapper">
                                        <img id="templateImage" src="${state.templates[state.currentTemplate][state.currentLang]}" alt="template" onclick="handleImageClick(event)" onload="renderFieldMarkers()">
                                        <div id="markersContainer"></div>
                                    </div>
                                </div>
                            ` : '<p style="color: #5A7A8F; text-align: center; padding: 40px;">ËØ∑ÂÖà‰∏ä‰º†Ê®°ÊùøÂõæÁâá</p>'}

                            <div class="action-buttons">
                                <button onclick="downloadConfig()" class="action-btn export-btn">üì• ÂØºÂá∫ÈÖçÁΩÆ</button>
                                <label class="action-btn import-label">
                                    üì§ ÂØºÂÖ•ÈÖçÁΩÆ
                                    <input type="file" accept=".json" onchange="loadConfig(event)" style="display:none">
                                </label>
                                <button onclick="clearAllData()" class="action-btn" style="background: #C73E1D; color: white;">
                                    üóëÔ∏è Ê∏ÖÁ©∫ÈÖçÁΩÆ
                                </button>
                            </div>
                            
                            <p style="text-align: center; font-size: 12px; color: #4A90A4; margin-top: 10px;">
                                üíæ ÈÖçÁΩÆÂ∑≤Ëá™Âä®‰øùÂ≠òÂà∞ÊµèËßàÂô®Êú¨Âú∞Â≠òÂÇ®
                            </p>
                        </div>

                        <div class="right-panel">
                            <h3 class="section-title">‚öôÔ∏è Â∑≤ÈÖçÁΩÆÂ≠óÊÆµ</h3>
                            
                            ${Object.keys(positions).length === 0 ? 
                                '<p style="color: #5A7A8F; text-align: center; padding: 20px;">ÊöÇÊó†ÈÖçÁΩÆ</p>' :
                                `<div class="field-list">
                                    ${Object.keys(positions).map(fieldKey => {
                                        const pos = positions[fieldKey];
                                        const baseField = pos.baseField || fieldKey;
                                        return `
                                            <div class="field-item">
                                                <div class="field-item-header">
                                                    <span class="field-name">üìå ${getFieldDisplayName(fieldKey)}</span>
                                                    <div class="field-actions">
                                                        <button onclick="repositionField('${fieldKey}')" class="reposition-btn ${state.repositionTarget === fieldKey ? 'active' : ''}">
                                                            ${state.repositionTarget === fieldKey ? 'ÁÇπÂáªÂõæÁâá' : 'ÈáçÊñ∞ÂÆö‰Ωç'}
                                                        </button>
                                                        <button onclick="editField('${fieldKey}')" class="edit-btn">ÁºñËæë</button>
                                                        <button onclick="deleteField('${fieldKey}')" class="delete-btn">Âà†Èô§</button>
                                                    </div>
                                                </div>
                                                
                                                ${state.editingField === fieldKey ? `
                                                    <div class="param-editor">
                                                        <div class="param-row">
                                                            <span class="param-label">Â≠ó‰ΩìÂ§ßÂ∞è:</span>
                                                            <input type="number" id="editFontSize" value="${pos.fontSize || 44}" min="8" max="120">
                                                        </div>
                                                        <div class="param-row">
                                                            <span class="param-label">È¢úËâ≤:</span>
                                                            <input type="color" id="editColor" value="${pos.color || '#000000'}" style="height: 40px;">
                                                        </div>
                                                        ${baseField === 'signature' ? `
                                                            <div class="param-row">
                                                                <span class="param-label">ÂÆΩÂ∫¶:</span>
                                                                <input type="number" id="editWidth" value="${pos.width || 150}" min="50" max="500">
                                                            </div>
                                                            <div class="param-row">
                                                                <span class="param-label">È´òÂ∫¶:</span>
                                                                <input type="number" id="editHeight" value="${pos.height || 50}" min="20" max="200">
                                                            </div>
                                                        ` : ''}
                                                        <button onclick="saveFieldParams()" class="save-param-btn">‚úÖ ‰øùÂ≠òÂèÇÊï∞</button>
                                                    </div>
                                                ` : `
                                                    <div class="field-params">
                                                        <div>X: ${pos.x}</div>
                                                        <div>Y: ${pos.y}</div>
                                                        <div>Â≠óÂè∑: ${pos.fontSize || 44}px</div>
                                                        <div>È¢úËâ≤: <span style="display: inline-block; width: 20px; height: 20px; background: ${pos.color || '#000000'}; border: 1px solid #ccc; vertical-align: middle;"></span></div>
                                                        ${pos.width ? `<div>ÂÆΩ: ${pos.width}px</div>` : ''}
                                                        ${pos.height ? `<div>È´ò: ${pos.height}px</div>` : ''}
                                                    </div>
                                                `}
                                            </div>
                                        `;
                                    }).join('')}
                                </div>`
                            }
                        </div>
                    </div>
                </div>
            `;
        }

        function renderUserMode() {
            const t = translations[state.language];
            const fields = getFieldsList(state.language).filter(f => !['signature', 'month', 'day', 'checkmark'].includes(f));
            
            return `
                <div class="container">
                    <h1>${t.title}</h1>
                    <div class="form-group">
                        <label>${t.selectLanguage}</label>
                        <div class="language-buttons">
                            ${[{ code: 'zh', label: '‰∏≠Êñá' }, { code: 'ko', label: 'ÌïúÍµ≠Ïñ¥' }, { code: 'vi', label: 'Ti·∫øng Vi·ªát' }, { code: 'ru', label: '–†—É—Å—Å–∫–∏–π' }].map(lang => 
                                `<button onclick="state.language='${lang.code}'; render();" class="lang-btn ${state.language === lang.code ? 'active' : ''}">${lang.label}</button>`
                            ).join('')}
                        </div>
                    </div>
                    ${fields.map(field => {
                        if (field === 'position') {
                            return `
                                <div class="form-group">
                                    <label>${t.position}</label>
                                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                                        <button onclick="state.positionMode='custom'; render();" class="lang-btn ${state.positionMode === 'custom' ? 'active' : ''}" style="flex: 1;">${t.positionCustom}</button>
                                        <button onclick="state.positionMode='select'; render();" class="lang-btn ${state.positionMode === 'select' ? 'active' : ''}" style="flex: 1;">${t.positionSelect}</button>
                                    </div>
                                    ${state.positionMode === 'custom' ? 
                                        `<input type="text" value="${state.formData[field] || ''}" oninput="state.formData['${field}'] = this.value">` :
                                        `<select onchange="state.formData['${field}'] = this.value" style="width: 100%; padding: 10px 15px; border: 2px solid #D4E4E7; border-radius: 8px; font-size: 14px;">
                                            <option value="">-- ${t.positionSelect} --</option>
                                            ${positionOptions[state.language].map(opt => 
                                                `<option value="${opt}" ${state.formData[field] === opt ? 'selected' : ''}>${opt}</option>`
                                            ).join('')}
                                        </select>`
                                    }
                                </div>
                            `;
                        } else if (field === 'phone') {
                            return `
                                <div class="form-group">
                                    <label>${t.phone}</label>
                                    <input type="text" value="${state.formData[field] || ''}" 
                                        oninput="state.formData['${field}'] = formatPhoneNumber(this.value); this.value = state.formData['${field}']">
                                </div>
                            `;
                        } else if (field === 'residentNum') {
                            return `
                                <div class="form-group">
                                    <label>${t.residentNum}</label>
                                    <input type="text" value="${state.formData[field] || ''}" 
                                        oninput="state.formData['${field}'] = formatResidentNum(this.value); this.value = state.formData['${field}']">
                                </div>
                            `;
                        } else if (field === 'experience') {
                            return `
                                <div class="form-group">
                                    <label>${t.experience}</label>
                                    <div style="position: relative;">
                                        <input type="text" value="${state.formData[field] || ''}" 
                                            oninput="state.formData['${field}'] = formatExperience(this.value); this.value = state.formData['${field}']"
                                            style="padding-right: 50px;">
                                        <span style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #5A7A8F; font-size: 14px; pointer-events: none;">${t.experienceYears}</span>
                                    </div>
                                </div>
                            `;
                        } else if (field === 'address') {
                            return `
                                <div class="form-group">
                                    <label>${t.address}</label>
                                    <div style="display: flex; gap: 10px;">
                                        <input type="text" value="${state.formData[field] || ''}" 
                                            oninput="state.formData['${field}'] = this.value"
                                            style="flex: 1;">
                                        <button onclick="openAddressSearch()" type="button" 
                                            style="padding: 10px 15px; background: #3E5F8A; color: white; border: none; border-radius: 8px; cursor: pointer; white-space: nowrap;">
                                            üó∫Ô∏è ${t.addressSearch}
                                        </button>
                                    </div>
                                    <p style="font-size: 11px; color: #5A7A8F; margin-top: 5px;">${t.addressHint}</p>
                                </div>
                            `;
                        } else {
                            return `
                                <div class="form-group">
                                    <label>${t[field]}</label>
                                    <input type="${field === 'birthday' ? 'date' : 'text'}" 
                                        value="${state.formData[field] || ''}" 
                                        oninput="state.formData['${field}'] = this.value">
                                </div>
                            `;
                        }
                    }).join('')}
                    <div class="form-group">
                        <label>${t.signature}</label>
                        <div class="signature-container">
                            <canvas id="signatureCanvas" width="400" height="150"></canvas>
                        </div>
                        <button onclick="clearSignature(); render();" class="clear-btn">${t.clearSignature}</button>
                    </div>
                    <button onclick="generateForms()" class="generate-btn">üì• ${t.generate}</button>
                    <p class="note">${t.generateNote}</p>
                    <button onclick="toggleMode()" class="toggle-btn" style="width:100%; margin-top:15px">${t.adminMode}</button>
                </div>
            `;
        }

        function render() {
            const app = document.getElementById('app');
            if (state.showPasswordPage) {
                app.innerHTML = renderPasswordPage();
                return;
            }
            
            app.innerHTML = state.isAdminMode ? renderAdminMode() : renderUserMode();
            
            if (state.isAdminMode) {
                setTimeout(renderFieldMarkers, 100);
            } else {
                signatureCanvas = document.getElementById('signatureCanvas');
                if (signatureCanvas) {
                    ctx = signatureCanvas.getContext('2d');
                    ctx.strokeStyle = '#000';
                    ctx.lineWidth = 2;
                    ctx.lineCap = 'round';
                    signatureCanvas.addEventListener('mousedown', startDrawing);
                    signatureCanvas.addEventListener('mousemove', draw);
                    signatureCanvas.addEventListener('mouseup', stopDrawing);
                    signatureCanvas.addEventListener('mouseleave', stopDrawing);
                    signatureCanvas.addEventListener('touchstart', startDrawing);
                    signatureCanvas.addEventListener('touchmove', draw);
                    signatureCanvas.addEventListener('touchend', stopDrawing);
                }
            }
        }
    </script>
</body>
</html>